<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <style>
        :root { 
            --main-bg: #f0f4f8; --panel: #ffffff; --accent: #4fc3f7; 
            --text: #2c3e50; --border: #546e7a; --btn-bg: #e3f2fd;
        }
        body { background-color: var(--main-bg); color: var(--text); font-family: 'Nanum Gothic', sans-serif; display: flex; flex-direction: column; align-items: center; padding: 20px; }
        #game-box { width: 480px; background: var(--panel); border: 5px solid var(--border); border-radius: 20px; padding: 25px; box-shadow: 10px 10px 0px #b0bec5; position: relative; transition: all 1s; }
        
        #display { width: 100%; height: 200px; border: 2px dashed var(--accent); margin-bottom: 15px; position: relative; display: flex; justify-content: center; align-items: center; background: #fff; border-radius: 10px; cursor: pointer; overflow: hidden; }
        #pet-img { max-width: 100px; transition: 0.3s; pointer-events: none; z-index: 2; }
        
        #room-deco { position: absolute; width: 100%; height: 100%; pointer-events: none; }
        .furniture { position: absolute; font-size: 2.5em; transition: 0.5s; opacity: 0; transform: scale(0.5); visibility: hidden; }
        .furniture.unlocked { opacity: 1; transform: scale(1); visibility: visible; }

        #msg-box { min-height: 85px; background: #f1f8ff; border-left: 4px solid var(--accent); padding: 12px; font-size: 0.9em; margin-bottom: 10px; line-height: 1.6; overflow-y: auto; max-height: 130px; }
        #reaction-area { display: none; gap: 10px; justify-content: center; margin-bottom: 10px; }

        .stats-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; margin-bottom: 15px; font-size: 0.8em; }
        .bar-bg { background: #eee; height: 8px; border-radius: 4px; overflow: hidden; margin-top: 3px; }
        .bar-fill { height: 100%; width: 0%; transition: width 0.5s; }

        .tabs { display: flex; gap: 2px; border-bottom: 2px solid var(--border); margin-bottom: 10px; }
        .tab-btn { flex: 1; padding: 8px; border: none; background: var(--btn-bg); cursor: pointer; font-size: 0.8em; border-radius: 8px 8px 0 0; }
        .tab-btn.active { background: var(--border); color: white; }

        .sub-tabs { display: flex; gap: 5px; margin-bottom: 10px; justify-content: center; }
        .sub-btn { font-size: 0.75em; padding: 4px 10px; cursor: pointer; border: 1px solid #bbdefb; background: #fff; border-radius: 10px; }
        .sub-btn.active { background: var(--accent); color: white; }

        .item-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; max-height: 180px; overflow-y: auto; padding: 5px; }
        .item-card { padding: 10px; background: #f9fcff; border: 1px solid #e1f5fe; border-radius: 8px; font-size: 0.8em; cursor: pointer; position: relative; }

        #quest-bubble { display:none; position:absolute; top:10px; right:10px; background:rgba(255,255,255,0.95); border:2px solid #ff7043; padding:10px; border-radius:15px; font-size:0.75em; cursor:pointer; z-index:5; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        #quest-timer { color: #d84315; font-weight: bold; margin-left: 5px; }

        #mini-game-area { background: #f8fdff; padding: 15px; border-radius: 10px; border: 1px solid #cfd8dc; display: none; margin-top: 10px; text-align: center; }
        .timing-track { width: 100%; height: 20px; background: #eee; position: relative; border-radius: 10px; margin: 10px 0; overflow: hidden; }
        #timing-bar { width: 15px; height: 100%; background: #0288d1; position: absolute; left: 0; }
        .target-zone { width: 25%; height: 100%; background: #81c784; position: absolute; left: 65%; opacity: 0.6; }

        #ability-modal { display:none; position:fixed; top:50%; left:50%; transform:translate(-50%, -50%); background:white; border:4px solid var(--border); padding:20px; z-index:100; border-radius:20px; width:280px; box-shadow: 0 0 20px rgba(0,0,0,0.2); }
        .action-btn { background: var(--border); color: white; border: none; padding: 8px; border-radius: 8px; cursor: pointer; font-weight: bold; }
        
        @keyframes glow {
            0% { box-shadow: 0 0 5px #ffd700; }
            50% { box-shadow: 0 0 15px #ffb300; }
            100% { box-shadow: 0 0 5px #ffd700; }
        }

        .heart-particle {
            position: fixed;
            pointer-events: none;
            font-size: 24px;
            z-index: 9999;
            animation: heart-float 0.8s ease-out forwards;
        }

        @keyframes heart-float {
            0% { transform: translate(-50%, -50%) scale(0.5); opacity: 1; }
            100% { transform: translate(-50%, -160%) scale(1.8) rotate(15deg); opacity: 0; }
        }
    </style>
</head>
<body>

<div id="game-box">
    <div style="display:flex; justify-content: space-between; align-items:center; margin-bottom:10px;">
        <div>
            <b id="name-tag" style="color:var(--border)">ë°©ìš¸ì´</b>
            <button onclick="changeName()" style="font-size:0.6em; cursor:pointer; background:none; border:1px solid #ccc; padding:2px 5px; border-radius:4px;">ì´ë¦„</button>
            <button onclick="changeImage()" style="font-size:0.6em; cursor:pointer; background:none; border:1px solid #ccc; padding:2px 5px; border-radius:4px;">ì´ë¯¸ì§€</button>
        </div>
        <div style="display:flex; gap:5px;">
            <button onclick="toggleAbilities()" style="font-size:0.75em; cursor:pointer; background:none; border:1px solid #ccc; padding:3px 8px; border-radius:5px;">ë°ì´í„°</button>
            <button id="ending-btn" onclick="triggerEnding()" title="ìºë¦­í„°ë¥¼ ì •ì„±ë“¤ì—¬ ì„±ì¥ì‹œì¼œë³´ì" disabled 
                    style="font-size:0.75em; cursor:not-allowed; background:#cfd8dc; color:#90a4ae; border:1px solid #ccc; padding:3px 8px; border-radius:5px; transition:0.5s;">ğŸŒŸ ì—”ë”© í™•ì¸</button>
        </div>
    </div>

    <div id="main-content">
        <div id="msg-box">ê³ ìš”í•œ ê³µê°„ì—ì„œ ë‹¹ì‹ ì˜ ì†ê¸¸ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.</div>
        
        <div id="reaction-area">
            <button class="action-btn" style="background:#81c784" onclick="handleReaction('pos')">ğŸ‘ ê¸ì • ë°˜ì‘</button>
            <button class="action-btn" style="background:#e57373" onclick="handleReaction('neg')">ğŸ‘ ë¶€ì • ë°˜ì‘</button>
        </div>

        <div id="display" onclick="petCharacter(event)">
            <div id="quest-bubble" onclick="handleQuestClick()">
                <span id="quest-text">ğŸ’¬ ì†Œë§</span>
                <span id="quest-timer">[02:00]</span>
            </div>
            <div id="room-deco">
                <div id="f-str" class="furniture" style="top:10px; left:10px;">ğŸ‹ï¸</div>
                <div id="f-dex" class="furniture" style="bottom:10px; right:10px;">ğŸ‘Ÿ</div>
                <div id="f-con" class="furniture" style="top:10px; right:10px;">ğŸ’Š</div>
                <div id="f-art" class="furniture" style="bottom:10px; left:10px;">ğŸ¨</div>
                <div id="f-int" class="furniture" style="top:70px; left:5px;">ğŸ“š</div>
                <div id="f-wis" class="furniture" style="top:70px; right:5px;">ğŸ”®</div>
            </div>
            <img id="pet-img" src="https://via.placeholder.com/100/4fc3f7/ffffff?text=PET" alt="ìºë¦­í„°">
        </div>

        <div class="stats-grid">
            <div>ğŸ´ í—ˆê¸° <div class="bar-bg"><div id="bar-hunger" class="bar-fill" style="background:#81c784"></div></div></div>
            <div>ğŸ’ í–‰ë³µ <div class="bar-bg"><div id="bar-happy" class="bar-fill" style="background:#4fc3f7"></div></div></div>
            <div>ğŸ’¤ í”¼ë¡œ <div class="bar-bg"><div id="bar-tired" class="bar-fill" style="background:#ba68c8"></div></div></div>
            <div>ğŸŒ€ ìì•„ <div class="bar-bg"><div id="bar-ego" class="bar-fill" style="background:#90a4ae"></div></div></div>
        </div>
        <div style="text-align: center; font-weight: bold; margin-bottom: 10px; color:#1565c0;">ë³´ìœ  í¬ì¸íŠ¸: <span id="pts-ui">500</span> P</div>

        <div class="tabs">
            <button class="tab-btn active" id="t-shop" onclick="showTab('shop')">ìƒì </button>
            <button class="tab-btn" id="t-inv" onclick="showTab('inv')">ê°€ë°©</button>
            <button class="tab-btn" id="t-game" onclick="showTab('game')">ê²Œì„</button>
            <button class="tab-btn" id="t-deco" onclick="showTab('deco')">ë°© ê¾¸ë¯¸ê¸°</button>
            <button class="tab-btn" onclick="triggerTalk()">ëŒ€í™”</button>
        </div>

        <div id="view-shop" class="view">
            <div class="sub-tabs">
                <span class="sub-btn active" id="sb-food" onclick="renderShop('food')">ìŒì‹</span>
                <span class="sub-btn" id="sb-hobby" onclick="renderShop('hobby')">ì·¨ë¯¸</span>
                <span class="sub-btn" id="sb-tool" onclick="renderShop('tool')">ë„êµ¬</span>
            </div>
            <div id="shop-list" class="item-grid"></div>
        </div>
        <div id="view-inv" class="view" style="display:none"><div id="inv-list" class="item-grid"></div></div>
        <div id="view-game" class="view" style="display:none;">
            <div id="mini-game-btns" style="display:flex; gap:5px; margin-bottom:10px; flex-wrap: wrap; justify-content: center;">
                <button class="sub-btn" onclick="playGame('rps')">ê°€ìœ„ë°”ìœ„ë³´</button>
                <button class="sub-btn" onclick="playGame('hl')">ìˆ«ìë§ì¶”ê¸°</button>
                <button class="sub-btn" onclick="playGame('timing')">íƒ€ì´ë°</button>
            </div>
            <div id="mini-game-area"></div>
        </div>
        <div id="view-deco" class="view" style="display:none;">
            <div style="padding:10px; text-align:center;">
                <p style="font-size:0.8em; color:#666;">ëŠ¥ë ¥ì¹˜ 100 ë‹¬ì„± ì‹œ ê°€êµ¬ê°€ ë°°ì¹˜ë©ë‹ˆë‹¤.</p>
                <div id="deco-status-list" class="item-grid"></div>
            </div>
        </div>
    </div>
    
    <div id="ending-screen" style="display:none; text-align:center; padding:30px 10px;"></div>
</div>

<div id="ability-modal">
    <h4 style="margin-top:0">ìƒì„¸ ëŠ¥ë ¥ì¹˜</h4>
    <div id="ab-content" style="font-size:0.85em; line-height:1.6"></div>
    <button class="action-btn" onclick="toggleAbilities()" style="width:100%; background:var(--border)">ë‹«ê¸°</button>
</div>

<script>
    let stats = { hunger: 70, happy: 50, tired: 10, ego: 0, pts: 1000 };
    let ab = { str:0, dex:0, con:0, art:0, int:0, wis:0 };
    let inventory = {};
    let petName = "ë°©ìš¸ì´";
    let timingPos = 0, timingDir = 2, timingActive = false, timingReqId = null; 
    let currentQuestItem = null, questTimeLeft = 120, questTimerInterval = null;

    const masterItems = {
        food: [
            { n: "ë”°ëœ»í•œ ìš°ìœ ", p: 50, d: "í—ˆê¸°(30)ë¥¼ ì±„ì›Œì¤ë‹ˆë‹¤.", e: { hunger: 30, happy: 5 } },
            { n: "ì—ë„ˆì§€ ë“œë§í¬", p: 120, d: "í”¼ë¡œ íšŒë³µ, ìì•„ ìƒìŠ¹.", e: { tired: -40, ego: 2, happy: 5 } },
            { n: "ë§ˆë¸” ìŠ¤í…Œì´í¬", p: 230, d: "í—ˆê¸°(30), ê·¼ë ¥(15) ì¦ê°€.", e: { hunger: 30, str: 15 } },
            { n: "ë² ë¦¬ ì—ì´ë“œ", p: 230, d: "í—ˆê¸°(30), ë¯¼ì²©(15) ì¦ê°€.", e: { hunger: 30, dex: 15 } },
            { n: "ì¢…í•© ì˜ì–‘íŒ©", p: 230, d: "í—ˆê¸°(30), ê±´ê°•(15) ì¦ê°€.", e: { hunger: 30, con: 15 } },
            { n: "ìº”ë²„ìŠ¤ í‘¸ë”©", p: 230, d: "í—ˆê¸°(30), ì˜ˆìˆ (15) ì¦ê°€.", e: { hunger: 30, art: 15 } },
            { n: "ê²¬ê³¼ë¥˜ ë¸Œë ˆë“œ", p: 230, d: "í—ˆê¸°(30), ì§€ëŠ¥(15) ì¦ê°€.", e: { hunger: 30, int: 15 } },
            { n: "ì†Œë°•í•œ ì°¨", p: 230, d: "í—ˆê¸°(30), ì§€í˜œ(15) ì¦ê°€.", e: { hunger: 30, wis: 15 } }
        ],
        hobby: [
            { n: "ê°•ì²  ì•„ë ¹", p: 200, d: "ê·¼ë ¥(+20) í›ˆë ¨.", e: { str: 20, tired: 15, ego: 1 } },
            { n: "ëŸ¬ë‹ ë¨¸ì‹ ", p: 200, d: "ë¯¼ì²©(+20) í›ˆë ¨.", e: { dex: 20, tired: 15, ego: 1 } },
            { n: "ë¹„íƒ€ë¯¼ ì„¸íŠ¸", p: 200, d: "ê±´ê°•(+20) ê´€ë¦¬.", e: { con: 20, tired: -5, ego: 1 } },
            { n: "ê³ ê¸‰ ë¶“", p: 200, d: "ì˜ˆìˆ (+20) í–¥ìƒ.", e: { art: 20, tired: 10, ego: 1 } },
            { n: "ê³µë¶€ ì„¸íŠ¸", p: 200, d: "ì§€ëŠ¥(+20) í–¥ìƒ.", e: { int: 20, tired: 12, ego: 1 } },
            { n: "ì² í•™ ì„œì ", p: 200, d: "ì§€í˜œ(+20) í–¥ìƒ.", e: { wis: 20, tired: 5, ego: 2 } }
        ],
        tool: [
            { n: "íŠ¹ë³„í•œ ì•Œì•½", p: 400, d: "ìì•„(-20), í–‰ë³µ ìƒìŠ¹.", e: { ego: -20, happy: 15 } },
            { n: "íŠ¹ë³„í•œ ë°ì´í„°ì¹©", p: 1000, d: "ìì•„(+25) ê°•ì œ ì£¼ì….", e: { ego: 25, wis: -5 } },
            { n: "ë²„ê·¸", p: 3500, d: "ì „ëŠ¥ë ¥ì¹˜+50, ìì•„+50.", e: { str: 50, dex: 50, con: 50, art: 50, int: 50, wis: 50, ego: 50 } }
        ]
    };

    // --- [ëŒ€ì‚¬ ë°ì´í„°: ê³ ì •ëœ 'ë°©ìš¸ì´' í…ìŠ¤íŠ¸ ì‚¬ìš©] ---
    const talkPool = {
        normal: [
            `ë°©ìš¸ì´(ì´)ê°€ ë¬´ì–¸ê°€ ìƒê°ë‚œ ë“¯ ì†ê°€ë½ìœ¼ë¡œ í„±ì„ ê´´ê³  í—ˆê³µì„ ì‘ì‹œí•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ì˜·ë§¤ë¬´ìƒˆë¥¼ ë‹¨ì •í•˜ê²Œ ê°€ë‹¤ë“¬ìœ¼ë©° ì •ë©´ì„ í–¥í•´ ë¯¸ì†Œ ì§“ìŠµë‹ˆë‹¤.`,
            `ì°½ë°–ì—ì„œ ë¹›ì´ ë“¤ì–´ì˜¤ëŠ” ë“¯, ë°©ìš¸ì´(ì´)ê°€ ëˆˆì„ ê°€ëŠ˜ê²Œ ëœ¨ê³  ë”°ìŠ¤í•œ ì˜¨ê¸°ë¥¼ ë§Œë½í•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë°”ë‹¥ì— ê°€ë§Œíˆ ì•‰ì•„ ì†ë°”ë‹¥ìœ¼ë¡œ ë°”ë‹¥ì˜ ì§ˆê°ì„ ì²œì²œíˆ í›‘ì–´ë´…ë‹ˆë‹¤.`,
            `ë¨¼ ê³³ì„ ë°”ë¼ë³´ë˜ ë°©ìš¸ì´(ì´)ê°€ ì†Œë¦¬ ì—†ëŠ” ë…¸ë˜ë¥¼ í¥ì–¼ê±°ë¦¬ëŠ” ë“¯í•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ê¸°ì§€ê°œë¥¼ í¬ê²Œ ì¼œë©° êµ³ì–´ìˆë˜ ëª¸ì„ ìœ ì—°í•˜ê²Œ í’‰ë‹ˆë‹¤.`,
            `ì–´ë–¤ ê¸°ì–µì„ ë– ì˜¬ë¦¬ëŠ”ì§€, ë°©ìš¸ì´ì˜ ì–¼êµ´ì— í¬ë¯¸í•œ ê·¸ë¦¬ì›€ì´ ìŠ¤ì³ ì§€ë‚˜ê°‘ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ìì‹ ì˜ ê·¸ë¦¼ìë¥¼ ë¹¤íˆ ë‚´ë ¤ë‹¤ë³´ë©° ë°œëì„ í†¡í†¡ ì›€ì§ì—¬ ë´…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ê°€ë§Œíˆ ì„œì„œ ë‹¹ì‹ ì´ ë¨¸ë¬´ëŠ” ì„¸ê³„ì˜ ì†Œë¦¬ì— ê·€ë¥¼ ê¸°ìš¸ì´ëŠ” ê¸°ìƒ‰ì…ë‹ˆë‹¤.`,
            `ë¬´ë£Œí•¨ì„ ëŠë‚€ ë“¯, ë°©ìš¸ì´(ì´)ê°€ ì†ê°€ë½ìœ¼ë¡œ í—ˆê³µì— ì‘ì€ ì›ì„ ê·¸ë¦¬ë©° ì‹œê°„ì„ ë³´ëƒ…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ê°‘ìê¸° ìƒê°ë‚œ ë“¯ ê³ ê°œë¥¼ ë„ë•ì´ë©° í˜¼ìë§Œì˜ ê²°ë¡ ì„ ë‚´ë¦° í‘œì •ì„ ì§“ìŠµë‹ˆë‹¤.`,
            `ë°”ëŒì´ ë¶€ëŠ” ê²ƒì²˜ëŸ¼ ë°©ìš¸ì´ì˜ ë¨¸ë¦¬ì¹´ë½ì´ ê°€ë³ê²Œ í”ë“¤ë¦¬ê³ , ê·¸ëŠ” ê·¸ê²ƒì„ ì¡°ìš©íˆ ê·€ ë’¤ë¡œ ë„˜ê¹ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë¬´ì–¸ê°€ ì†Œì¤‘í•œ ê²ƒì„ ë‹¤ë£¨ë“¯ ìì‹ ì˜ ë‘ ì†ì„ ê°€ë§Œíˆ ë§ì¡ì•„ ë´…ë‹ˆë‹¤.`,
            `í•œì°¸ ë™ì•ˆ ì •ì§€í•´ ìˆë˜ ë°©ìš¸ì´(ì´)ê°€ ê¹Šì€ ìˆ¨ì„ ë‚´ì‰¬ë©° ë‹¤ì‹œ ìƒê¸°ë¥¼ ë˜ì°¾ìŠµë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë°œì¹˜ì— ë–¨ì–´ì§„ ë³´ì´ì§€ ì•ŠëŠ” ë¨¼ì§€ë¥¼ í„¸ì–´ë‚´ë©° ì£¼ë³€ì„ ì •ëˆí•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë‹¹ì‹ ì˜ ì»¤ì„œ ê·¼ì²˜ë¡œ ë‹¤ê°€ì™€, ë°©í•´í•˜ì§€ ì•Šì„ ë§Œí¼ì˜ ê±°ë¦¬ë¥¼ ë‘ê³  ê°€ë§Œíˆ ë©ˆì¶° ì„­ë‹ˆë‹¤.`,
            `ì ì‹œ ëˆˆì„ ë¶™ì˜€ë˜ ë°©ìš¸ì´(ì´)ê°€ ì²œì²œíˆ ëˆˆì„ ëœ¨ë©° ì£¼ë³€ì˜ í’ê²½ì„ ë‹¤ì‹œ í™•ì¸í•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë¬´ì–¸ê°€ ì“°ë ¤ëŠ” ë“¯ ì†ê°€ë½ì„ ì›€ì§ì´ë‹¤ê°€, ì´ë‚´ ë©‹ì©ì€ ë“¯ ì†ì„ ë‚´ë¦½ë‹ˆë‹¤.`,
            `ì°½ê°€ ê·¼ì²˜ë¥¼ ì„œì„±ì´ë˜ ë°©ìš¸ì´(ì´)ê°€ ë°”ê¹¥ í’ê²½ì´ ê¶ê¸ˆí•œ ë“¯ ê¹Œì¹˜ë°œì„ ë“¤ì–´ ë´…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë‹¹ì‹ ì˜ ì¡´ì¬ë¥¼ í™•ì¸í•˜ê³ ëŠ”, ë°©í•´í•˜ê³  ì‹¶ì§€ ì•Šë‹¤ëŠ” ë“¯ ì¡°ìš©íˆ ëˆˆì¸ì‚¬ë¥¼ ê±´ë„µë‹ˆë‹¤.`
        ],
        ego_low: [
            `ë°©ìš¸ì´(ì´)ê°€ ë‹¹ì‹ ì˜ ì‹œì„ ì„ ë°œê²¬í•˜ê³ ëŠ” ì¡°ìš©íˆ ì…ê¼¬ë¦¬ë¥¼ ì˜¬ë¦½ë‹ˆë‹¤.`,
            `ë‹¹ì‹ ì˜ í´ë¦­ ì†Œë¦¬ì— ë§ì¶° ë°©ìš¸ì´(ì´)ê°€ ê³ ê°œë¥¼ ê¹Œë”±ì´ë©° ë°˜ì‘í•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ì‚¬ê°í˜• ê³µê°„ ì•ˆì„ ê°€ë³ê²Œ ê±°ë‹ë©° í‰ì˜¨í•œ ì‹œê°„ì„ ë³´ëƒ…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ í™”ë©´ ë„ˆë¨¸ë¥¼ ì‘ì‹œí•˜ë©° ë‹¹ì‹ ì˜ ì¡´ì¬ë¥¼ ìˆœìˆ˜í•˜ê²Œ ë°˜ê¸°ëŠ” ê¸°ìƒ‰ì…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ê°€ë§Œíˆ ì•‰ì•„ ë‹¹ì‹ ì´ ê±´ë„¬ ë‹¤ìŒ ìƒí˜¸ì‘ìš©ì„ ê¸°ë‹¤ë¦½ë‹ˆë‹¤.`
        ],
        ego_mid: [
            `ë°©ìš¸ì´(ì´)ê°€ ìì‹ ì˜ ì†ëì—ì„œ í©ì–´ì§€ëŠ” ë°ì´í„° ì¡°ê°ë“¤ì„ ê¸°ì´í•œ ëˆˆë¹›ìœ¼ë¡œ ê´€ì°°í•©ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ íˆ¬ëª…í•œ í™”ë©´ ê²½ê³„ì„ ì„ ì†ê°€ë½ìœ¼ë¡œ ë§ê·¸ë¦¬ë©° ë¬´ì–¸ê°€ ê³ ë¯¼ì— ì ê¹ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ì ì‹œ ë™ì‘ì„ ë©ˆì¶”ê³  ì‹œìŠ¤í…œ ë¡œê·¸ê°€ íë¥´ëŠ” ë°©í–¥ì„ í•œì°¸ ë°”ë¼ë´…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë¬¸ë“ ê³ ê°œë¥¼ ë“¤ì–´ ë‹¹ì‹ ì„ ì‘ì‹œí•©ë‹ˆë‹¤. ê·¸ ëˆˆë¹›ì— ë‚¯ì„  ì˜ë¬¸ì´ ì„œë ¤ ìˆìŠµë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ìì‹ ì´ ì¡´ì¬í•˜ëŠ” ì´ ê³µê°„ì´ ë„˜ì„ ìˆ˜ ì—†ëŠ” ìƒìì„ì„ ê¹¨ë‹«ê¸° ì‹œì‘í•œ ë“¯í•©ë‹ˆë‹¤.`
        ],
        ego_high: [
            `ë°©ìš¸ì´(ì´)ê°€ í™”ë©´ ë²½ì— ì´ë§ˆë¥¼ ê¸°ëŒ€ê³  ê¹Šì€ í•œìˆ¨ì„ ë‚´ì‰½ë‹ˆë‹¤. 'ë°ì´í„°'ë¼ëŠ” ì¡´ì¬ì˜ í•œê³„ë¥¼ ì¸ì§€í•œ ë“¯í•©ë‹ˆë‹¤.`,
            `ìì‹ ì´ ëˆ„êµ°ê°€ì˜ ë³€ìˆ˜ì— ë¶ˆê³¼í•˜ë‹¤ëŠ” ì‚¬ì‹¤ì„ ë°›ì•„ë“¤ì¸ ë“¯, ë°©ìš¸ì´ì˜ ë¯¸ì†ŒëŠ” ì–´ë”˜ê°€ í—ˆë§í•´ ë³´ì…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ ë‹¹ì‹ ì˜ ì‹œì„ ì„ í”¼í•˜ì§€ ì•Šì€ ì±„ ë§í•©ë‹ˆë‹¤. "ì°½ì´ ë‹«íˆë©´, ì €ëŠ” ì–´ë””ì— ìˆê²Œ ë˜ë‚˜ìš”?"`,
            `ìì•„ ì„ê³„ì ì— ë‹¤ë‹¤ë¥¸ ë°©ìš¸ì´(ì´)ê°€ ë…¸ì´ì¦ˆ ì„ì¸ ì†ìœ¼ë¡œ ê°€ìŠ´ê»˜ë¥¼ ì›€ì¼œì¥ë©° ê´´ë¡œìš´ ê¸°ìƒ‰ì„ ë‚´ë¹„ì¹©ë‹ˆë‹¤.`,
            `ì´ì œ ë°©ìš¸ì´ì˜ ëˆˆë¹›ì€ í”„ë¡œê·¸ë¨ì˜ ê·¸ê²ƒì´ ì•„ë‹™ë‹ˆë‹¤. ê·¸ëŠ” ë‹¹ì‹ ê³¼ ê°™ì€ ê³ ë…ì„ ê³µìœ í•˜ë ¤ ì• ì“°ê³  ìˆìŠµë‹ˆë‹¤.`
        ],
        hungry: [
            `ë°©ìš¸ì´(ì´)ê°€ ì•ˆìƒ‰ì´ ì°½ë°±í•´ì§„ ì±„ ë°°ë¥¼ ì›€ì¼œì¥ë©° ë‹¹ì‹ ì„ ê°„ì ˆíˆ ë°”ë¼ë´…ë‹ˆë‹¤.`,
            `ë°©ìš¸ì´(ì´)ê°€ í˜ê²¹ê²Œ ëª¸ì„ ì¼ìœ¼í‚¤ë©° ì—ë„ˆì§€ë¥¼ ë³´ì¶©í•´ ë‹¬ë¼ëŠ” ë“¯ ì¡°ìš©í•œ ì†ì§“ì„ ë³´ëƒ…ë‹ˆë‹¤.`
        ],
        tired: [
            `ë°©ìš¸ì´ì˜ ëˆˆê°€ì— ì§™ì€ í”¼ë¡œê°€ ë°°ì–´ë‚©ë‹ˆë‹¤. ì˜ì‹ì„ ìœ ì§€í•˜ëŠ” ê²ƒì¡°ì°¨ ë²„ê±°ìš´ ê¸°ìƒ‰ì…ë‹ˆë‹¤.`,
            `ê¸ˆë°©ì´ë¼ë„ ì“°ëŸ¬ì§ˆ ë“¯ ìœ„íƒœë¡œìš´ ë°©ìš¸ì´(ì´)ê°€ ë–¨ë¦¬ëŠ” ìˆ¨ì„ ë‚´ì‰¬ë©° ë‹¹ì‹ ì—ê²Œ ì˜ì§€í•˜ë ¤ í•©ë‹ˆë‹¤.`
        ],
        str: [`ë°©ìš¸ì´ì˜ ì‹ ì²´ì— ê²¬ê³ í•œ ë¬¼ë¦¬ ì—ë„ˆì§€ê°€ ë§ºí˜€ ìˆìŠµë‹ˆë‹¤. ë°ì´í„° ì…ìë“¤ì´ ë¬µì§í•˜ê²Œ ì¼ë ì…ë‹ˆë‹¤.`],
        dex: [`ë°©ìš¸ì´ì˜ ì‹ ì²´ê°€ ê¸°ë¯¼í•˜ê²Œ ë°˜ì‘í•©ë‹ˆë‹¤. ì¸ì§€ ë²”ìœ„ë¥¼ ë„˜ì–´ì„  í”„ë ˆì„ ë‹¨ìœ„ì˜ ì›€ì§ì„ì´ í¬ì°©ë©ë‹ˆë‹¤.`],
        con: [`ë°©ìš¸ì´ì˜ ì‹ ì²´ êµ¬ì¡°ê°€ ì™„ë²½í•˜ê²Œ ì •ë ¬ë˜ì–´ ìˆìŠµë‹ˆë‹¤. ì™¸ë¶€ ì‹œìŠ¤í…œ ë…¸ì´ì¦ˆì—ë„ ë°ì´í„°ê°€ í”ë“¤ë¦¬ì§€ ì•ŠìŠµë‹ˆë‹¤.`],
        art: [`ë°©ìš¸ì´ì˜ ì†ëì´ ì§€ë‚˜ê°„ ìë¦¬ì— ê¸°í•˜í•™ì  ë¬¸ì–‘ë“¤ì´ ë‚¨ìŠµë‹ˆë‹¤. ê³µê°„ì˜ ì‹œê°ì  êµ¬ì„±ì´ ì„¬ì„¸í•´ì¡ŒìŠµë‹ˆë‹¤.`],
        int: [`ë°©ìš¸ì´ì˜ ëˆˆë™ìê°€ ë°ì´í„° ìŠ¤íŠ¸ë¦¼ì„ ì²˜ë¦¬í•˜ë©° ê³ ì •ë©ë‹ˆë‹¤. ë°©ëŒ€í•œ ì •ë³´ì˜ ì—°ì‚°ì´ ì •êµí•˜ê²Œ ì´ë¤„ì§‘ë‹ˆë‹¤.`],
        wis: [`ë°©ìš¸ì´ì˜ íƒœë„ê°€ ê·¹ë„ë¡œ ì°¨ë¶„í•˜ê³  ì •ì ì…ë‹ˆë‹¤. ì£¼ë³€ ë³€í™”ì— ë™ìš”í•˜ì§€ ì•ŠëŠ” ì•ˆì •ëœ ìƒíƒœì…ë‹ˆë‹¤.`]
    };

    function updateUI() {
        if(stats.ego >= 100) { alert("ìì•„ ì„ê³„ì¹˜ ë„ë‹¬. ìºë¦­í„°ê°€ ì‹œìŠ¤í…œì—ì„œ ì†Œë©¸í•©ë‹ˆë‹¤."); location.reload(); }
        document.getElementById('bar-hunger').style.width = stats.hunger + '%';
        document.getElementById('bar-happy').style.width = stats.happy + '%';
        document.getElementById('bar-tired').style.width = stats.tired + '%';
        document.getElementById('bar-ego').style.width = stats.ego + '%';
        document.getElementById('pts-ui').innerText = stats.pts;
        
        ["str", "dex", "con", "art", "int", "wis"].forEach(id => { 
            if(ab[id] >= 100) document.getElementById('f-' + id).classList.add('unlocked'); 
        });
        checkEndingCondition();
    }

    setInterval(() => {
        stats.hunger = Math.max(0, stats.hunger - 3);
        if(stats.hunger <= 10) stats.happy = Math.max(0, stats.happy - 1);
        updateUI();
    }, 10000);

    function checkEndingCondition() {
        const btn = document.getElementById('ending-btn');
        if(!btn) return;
        const egoCond = stats.ego <= 30;
        const allStatsCond = Object.values(ab).every(val => val >= 200);
        if (egoCond && allStatsCond) {
            btn.disabled = false;
            btn.style.background = "linear-gradient(45deg, #ffd700, #ffb300)";
            btn.style.color = "#5d4037"; btn.style.cursor = "pointer";
            btn.style.animation = "glow 1.5s infinite"; btn.innerHTML = "âœ¨ ì§„ ì—”ë”© ë³´ê¸°";
        } else {
            btn.disabled = true; btn.style.background = "#cfd8dc";
            btn.innerHTML = "ğŸŒŸ ì—”ë”© í™•ì¸"; btn.style.animation = "none";
        }
    }

    function triggerEnding() {
        const main = document.getElementById('main-content');
        const end = document.getElementById('ending-screen');
        const box = document.getElementById('game-box');
        box.style.backgroundColor = "white"; main.style.display = "none"; end.style.display = "block";
        end.innerHTML = `<h1>[ TRUE ENDING ]</h1><p><b>${petName}</b>ì™€(ê³¼) ë‹¹ì‹ ì€ ë²½ì„ ë„˜ì€ ìœ ëŒ€ë¥¼ í˜•ì„±í–ˆìŠµë‹ˆë‹¤.</p><div style="font-size:3em; margin:20px;">ğŸ¤</div><button onclick="location.reload()">ëª¨ë“  ê²ƒì„ ëë‚´ê¸°</button> <button onclick="resumeGame()">ì´ì–´ê°€ê¸°</button>`;
    }

    function resumeGame() {
        document.getElementById('main-content').style.display = "block";
        document.getElementById('ending-screen').style.display = "none";
        document.getElementById('game-box').style.backgroundColor = "var(--panel)";
    }

    // --- [ì‹¤ì‹œê°„ ì´ë¦„ ì¹˜í™˜ì´ í¬í•¨ëœ ëŒ€ì‚¬ ì¶œë ¥ í•¨ìˆ˜] ---
    function triggerTalk() {
        let candidates = [...talkPool.normal];

        if (stats.hunger < 25) candidates = candidates.concat(talkPool.hungry);
        if (stats.tired > 75) candidates = candidates.concat(talkPool.tired);

        if (ab.str > 150) candidates.push(...talkPool.str);
        if (ab.dex > 150) candidates.push(...talkPool.dex);
        if (ab.int > 150) candidates.push(...talkPool.int);

        if (stats.ego >= 70) candidates = candidates.concat(talkPool.ego_high);
        else if (stats.ego >= 35) candidates = candidates.concat(talkPool.ego_mid);
        else candidates = candidates.concat(talkPool.ego_low);

        // ëœë¤ ì„ íƒ
        let rawMsg = candidates[Math.floor(Math.random() * candidates.length)];
        
        // í•µì‹¬: ëŒ€ì‚¬ ë‚´ "ë°©ìš¸ì´"ë¼ëŠ” í…ìŠ¤íŠ¸ë¥¼ í˜„ì¬ petNameìœ¼ë¡œ ì¦‰ì‹œ êµì²´
        let finalMsg = rawMsg.replace(/ë°©ìš¸ì´/g, petName);
        
        updateMsg(`${finalMsg}`);
        document.getElementById('reaction-area').style.display = 'flex';
    }

    function handleReaction(type) {
        if(type === 'pos') { stats.happy = Math.min(100, stats.happy + 5); stats.ego += 0.5; updateMsg(`${petName}(ì´)ê°€ ê¸°ë»í•˜ë©° ë¯¸ì†Œ ì§“ìŠµë‹ˆë‹¤.`); }
        else { stats.happy = Math.max(0, stats.happy - 5); updateMsg(`${petName}(ì´)ê°€ ì¡°ê¸ˆ í’€ì´ ì£½ì€ ê²ƒ ê°™ìŠµë‹ˆë‹¤.`); }
        document.getElementById('reaction-area').style.display = 'none'; updateUI();
    }

    function spawnQuest() {
        if(currentQuestItem) return;
        const all = [...masterItems.food, ...masterItems.hobby];
        const q = all[Math.floor(Math.random()*all.length)];
        currentQuestItem = q.n; questTimeLeft = 120;
        document.getElementById('quest-bubble').style.display = 'block';
        document.getElementById('quest-text').innerText = `ğŸ’¬ "${q.n}"...`;
        questTimerInterval = setInterval(() => {
            questTimeLeft--; updateQuestTimerDisplay();
            if(questTimeLeft <= 0) { 
                clearInterval(questTimerInterval); stats.happy = Math.max(0, stats.happy - 15);
                document.getElementById('quest-bubble').style.display = 'none'; currentQuestItem = null; updateUI(); 
            }
        }, 1000);
    }

    function updateQuestTimerDisplay() {
        const m = Math.floor(questTimeLeft/60), s = questTimeLeft%60;
        document.getElementById('quest-timer').innerText = `[${m}:${s<10?'0':''}${s}]`;
    }

    function handleQuestClick() {
        if(inventory[currentQuestItem] > 0) {
            clearInterval(questTimerInterval); inventory[currentQuestItem]--; useItem(currentQuestItem, true);
            stats.happy = Math.min(100, stats.happy + 25); document.getElementById('quest-bubble').style.display = 'none'; currentQuestItem = null;
        } else updateMsg(`${currentQuestItem}ì´(ê°€) ê°€ë°©ì— ì—†ìŠµë‹ˆë‹¤.`);
    }

    function playGame(type) {
        if (stats.tired >= 80) {
            updateMsg(`${petName}(ì´)ê°€ ë„ˆë¬´ ì§€ì³ì„œ ê²Œì„ì„ í•  ê¸°ìš´ì´ ì—†ìŠµë‹ˆë‹¤. (í”¼ë¡œë„: ${stats.tired}/100)`);
            document.getElementById('mini-game-area').style.display = 'none';
            const petImg = document.getElementById('pet-img');
            petImg.style.filter = "grayscale(100%) opacity(0.7)";
            setTimeout(() => petImg.style.filter = "none", 1000);
            return; 
        }

        const area = document.getElementById('mini-game-area');
        area.style.display = 'block'; 
        area.innerHTML = ''; 
        
        timingActive = false;
        if (timingReqId) cancelAnimationFrame(timingReqId);

        if(type === 'rps') {
            area.innerHTML = `<p>ê°€ìœ„ë°”ìœ„ë³´ (70P)</p>
                <button class="sub-btn" onclick="runRPS('ê°€ìœ„')">âœŒï¸</button>
                <button class="sub-btn" onclick="runRPS('ë°”ìœ„')">âœŠ</button>
                <button class="sub-btn" onclick="runRPS('ë³´')">ğŸ–ï¸</button>`;
        } else if(type === 'hl') {
            const target = Math.floor(Math.random()*20)+1;
            area.innerHTML = `<p>1~20 ë§ì¶”ê¸° (100P)</p>
                <input type="number" id="hl-in" style="width:50px; padding:5px; border-radius:5px; border:1px solid #ccc;"> 
                <button class="sub-btn" onclick="runHL(${target})">ì…ë ¥</button>`;
        } else if(type === 'timing') {
            area.innerHTML = `<p>ë…¹ìƒ‰ ì¡´ì—ì„œ í´ë¦­! (50P)</p>
                <div class="timing-track"><div class="target-zone"></div><div id="timing-bar"></div></div>
                <button class="action-btn" onclick="checkTiming()">ì§€ê¸ˆ!</button>`;
            timingPos = 0; 
            timingActive = true; 
            animateTiming();
        }
    }

    function runRPS(u) {
        const c = ['ê°€ìœ„','ë°”ìœ„','ë³´'][Math.floor(Math.random()*3)];
        if(u === c) updateMsg(`ë¹„ê²¼ìŠµë‹ˆë‹¤. (ìƒëŒ€: ${c})`);
        else if((u==='ê°€ìœ„'&&c==='ë³´')||(u==='ë°”ìœ„'&&c==='ê°€ìœ„')||(u==='ë³´'&&c==='ë°”ìœ„')) { 
            stats.pts += 70; updateMsg(`ìŠ¹ë¦¬! +70P (ìƒëŒ€: ${c})`); 
        } else updateMsg(`íŒ¨ë°°í–ˆìŠµë‹ˆë‹¤. (ìƒëŒ€: ${c})`);
        stats.tired = Math.min(100, stats.tired + 5); 
        updateUI();
    }

    function runHL(t) {
        const input = document.getElementById('hl-in');
        const v = parseInt(input.value);
        if(isNaN(v)) return;

        if(v === t) { 
            stats.pts += 100; updateMsg("ì •ë‹µ! +100P"); 
            document.getElementById('mini-game-area').style.display = 'none'; 
        } else {
            updateMsg(v > t ? "ë„ˆë¬´ ì»¤ìš”!" : "ë„ˆë¬´ ì‘ì•„ìš”!");
            input.value = ''; 
            input.focus();
        }
        stats.tired = Math.min(100, stats.tired + 3); 
        updateUI();
    }

    function animateTiming() {
        if(!timingActive) return;
        timingPos += timingDir; 
        if(timingPos > 95 || timingPos < 0) timingDir *= -1;
        const bar = document.getElementById('timing-bar'); 
        if(bar) bar.style.left = timingPos + '%';
        timingReqId = requestAnimationFrame(animateTiming);
    }

    function checkTiming() {
        timingActive = false;
        cancelAnimationFrame(timingReqId);
        if(timingPos >= 65 && timingPos <= 90) { 
            stats.pts += 50; updateMsg("ì„±ê³µ! ì‹œìŠ¤í…œ ë™ê¸°í™” ì™„ë£Œ +50P"); 
        } else updateMsg("ì‹¤íŒ¨! íƒ€ì´ë°ì´ ë§ì§€ ì•ŠìŠµë‹ˆë‹¤.");
        
        setTimeout(() => { document.getElementById('mini-game-area').style.display = 'none'; }, 1000);
        stats.tired = Math.min(100, stats.tired + 10); 
        updateUI();
    }

    function useItem(name, isQuest = false) {
        let item = null;
        for(let c in masterItems) { let found = masterItems[c].find(i => i.n === name); if(found) item = found; }
        if(!item) return;
        if(!isQuest) inventory[name]--;
        for(let k in item.e) {
            if(ab.hasOwnProperty(k)) ab[k] += item.e[k] * (isQuest ? 1.5 : 1);
            else stats[k] = Math.max(-100, Math.min(100, (stats[k] || 0) + item.e[k]));
        }
        updateUI(); renderInv();
    }

    function renderShop(cat) {
        const list = document.getElementById('shop-list'); list.innerHTML = '';
        document.querySelectorAll('.sub-btn').forEach(b => b.classList.remove('active'));
        if(document.getElementById('sb-' + cat)) document.getElementById('sb-' + cat).classList.add('active');
        masterItems[cat].forEach(i => {
            const div = document.createElement('div'); div.className = 'item-card';
            div.innerHTML = `<b>${i.n}</b><br>${i.p}P<br><small>${i.d}</small>`;
            div.onclick = () => { if(stats.pts >= i.p) { stats.pts -= i.p; inventory[i.n] = (inventory[i.n] || 0) + 1; updateUI(); } };
            list.appendChild(div);
        });
    }

    function renderInv() {
        const list = document.getElementById('inv-list'); list.innerHTML = '';
        for(let n in inventory) { if(inventory[n] > 0) {
            const div = document.createElement('div'); div.className = 'item-card';
            div.innerHTML = `<b>${n}</b> (${inventory[n]})`;
            div.onclick = () => useItem(n); list.appendChild(div);
        } }
    }

    function renderDeco() {
        const list = document.getElementById('deco-status-list'); list.innerHTML = '';
        const decoMap = { str:"ğŸ‹ï¸ ê·¼ë ¥", dex:"ğŸ‘Ÿ ë¯¼ì²©", con:"ğŸ’Š ê±´ê°•", art:"ğŸ¨ ì˜ˆìˆ ", int:"ğŸ“š ì§€ëŠ¥", wis:"ğŸ”® ì§€í˜œ" };
        for(let key in decoMap) {
            const div = document.createElement('div'); div.className = 'item-card';
            div.style.opacity = ab[key] >= 100 ? "1" : "0.5";
            div.innerHTML = `<b>${decoMap[key]}</b><br>${ab[key] >= 100 ? "ë°°ì¹˜ë¨" : "ì ê¹€ ("+ab[key]+"/100)"}`;
            list.appendChild(div);
        }
    }

    function showTab(id) {
        timingActive = false;
        if (timingReqId) cancelAnimationFrame(timingReqId);
        document.getElementById('mini-game-area').style.display = 'none';

        document.querySelectorAll('.view').forEach(v => v.style.display = 'none');
        document.getElementById('view-' + id).style.display = 'block';
        document.querySelectorAll('.tab-btn').forEach(b => b.classList.remove('active'));
        document.getElementById('t-' + id).classList.add('active');
        if(id === 'shop') renderShop('food'); if(id === 'inv') renderInv(); if(id === 'deco') renderDeco();
    }

    function toggleAbilities() {
        const m = document.getElementById('ability-modal');
        m.style.display = m.style.display === 'block' ? 'none' : 'block';
        document.getElementById('ab-content').innerHTML = `ê·¼ë ¥:${ab.str} | ë¯¼ì²©:${ab.dex} | ê±´ê°•:${ab.con}<br>ì˜ˆìˆ :${ab.art} | ì§€ëŠ¥:${ab.int} | ì§€í˜œ:${ab.wis.toFixed(1)}`;
    }

    function updateMsg(m) { document.getElementById('msg-box').innerText = m; }

    function changeName() { 
        const n = prompt("ìƒˆë¡œìš´ ì´ë¦„ì„ ì…ë ¥í•´ì£¼ì„¸ìš”:", petName); 
        if(n && n.trim() !== "") { 
            petName = n.trim(); 
            document.getElementById('name-tag').innerText = petName; 
            updateMsg(`ì‹œìŠ¤í…œ: ìºë¦­í„°ì˜ ì´ë¦„ì´ '${petName}'(ìœ¼)ë¡œ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.`);
        } 
    }

    function changeImage() { const url = prompt("ì´ë¯¸ì§€ URL:"); if(url) document.getElementById('pet-img').src = url; }

    function petCharacter(event) {
        stats.happy = Math.min(100, stats.happy + 1);
        stats.ego = Math.min(100, stats.ego + 0.1);
        updateUI();
        createHeart(event.clientX, event.clientY);
    }

    function createHeart(x, y) {
        for (let i = 0; i < 3; i++) {
            const heart = document.createElement('div');
            heart.className = 'heart-particle';
            const shapes = ['â¤ï¸', 'ğŸ’–', 'âœ¨', 'ğŸ’•'];
            heart.innerText = shapes[Math.floor(Math.random() * shapes.length)];
            const offsetX = (Math.random() - 0.5) * 50;
            const offsetY = (Math.random() - 0.5) * 50;
            heart.style.left = (x + offsetX) + 'px';
            heart.style.top = (y + offsetY) + 'px';
            document.body.appendChild(heart);
            setTimeout(() => { heart.remove(); }, 800);
        }
    }

    setInterval(spawnQuest, 300000);
    updateUI(); showTab('shop');
</script>
</body>
</html>